#!/usr/bin/env bash

_cmd=$_

. ./../../tools/env.sh


# post-checkout is the first build-hook; See doc/dev.md

echo '---------- post_checkout '$(pwd)
echo "Term: $TERM"
echo "Shell: $SHELL"
echo "Shell Cmd: '$0' '$*'"
echo "Post-Checkout Hook Cmd: $_cmd"
echo "Shell PID: $$"
echo "Shell options: $-"

curl -sSf -X POST \
  "https://dotmpe.com/build.php?i=${BUILD_KEY}&SCM_REF=$GIT_SHA1&BUILD_ID=${BUILD_CODE}&START=$(urlsafe_datetime)"

test "$GIT_SHA1" = "$( git rev-parse HEAD )"  || {
  echo "Illegal env"
  exit 1
}


env | grep -qv 'MIIEpAIBAAKCAQEA3pR1e5PZVxgfSwlgo' || exit 123


# Id: x-docker/0.0.2-dev tools/hooks/post_checkout
